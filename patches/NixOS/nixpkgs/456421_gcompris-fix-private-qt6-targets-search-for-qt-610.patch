From e9cd95786544873c69db3b31f40e29b628ebe7ea Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Tue, 28 Oct 2025 11:30:04 +0100
Subject: [PATCH] gcompris: fix private Qt6 targets search for Qt 6.10

fix https://hydra.nixos.org/build/311320100/log/tail
```
CMake Error at src/core/CMakeLists.txt:112 (target_link_libraries):
  Target "gcompris-qt" links to:

    Qt6::CorePrivate

  but the target was not found.  Possible reasons include:

    * There is a typo in the target name.
    * A find_package call is missing for an IMPORTED target.
    * An ALIAS target is missing.
```
---
 pkgs/by-name/gc/gcompris/package.nix | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/pkgs/by-name/gc/gcompris/package.nix b/pkgs/by-name/gc/gcompris/package.nix
index df8f4c6e90f1f1..438f28ca1425d0 100644
--- a/pkgs/by-name/gc/gcompris/package.nix
+++ b/pkgs/by-name/gc/gcompris/package.nix
@@ -18,11 +18,16 @@ stdenv.mkDerivation (finalAttrs: {
     hash = "sha256-Y23pFov1/WKPrwYYRfGI8sOF0tp/ksSwRJE5zmxtoSo=";
   };
 
-  # fix concatenation of absolute paths like
-  # /nix/store/77zcv3vmndif01d4wh1rh0d1dyvyqzpy-gcompris-25.1.1/bin/..//nix/store/77zcv3vmndif01d4wh1rh0d1dyvyqzpy-gcompris-25.1.1/share/gcompris-qt/rcc/core.rcc
   postPatch = ''
+    # fix concatenation of absolute paths like
+    # /nix/store/77zcv3vmndif01d4wh1rh0d1dyvyqzpy-gcompris-25.1.1/bin/..//nix/store/77zcv3vmndif01d4wh1rh0d1dyvyqzpy-gcompris-25.1.1/share/gcompris-qt/rcc/core.rcc
     substituteInPlace src/core/config.h.in  --replace-fail \
       "../@_data_dest_dir@" "../share/gcompris-qt"
+
+    # Fix private Qt6 targets search for Qt 6.10
+    substituteInPlace CMakeLists.txt --replace-fail \
+      "set(QT_COMPONENTS Qml Quick Gui Multimedia Core Svg Network LinguistTools Sensors QuickControls2 QuickTemplates2 Charts Widgets QmlWorkerScript)" \
+      "set(QT_COMPONENTS Qml Quick Gui Multimedia Core Svg Network LinguistTools Sensors QuickControls2 QuickTemplates2 Charts Widgets QmlWorkerScript CorePrivate QuickControls2BasicPrivate WaylandClientPrivate)"
   '';
 
   cmakeFlags = [
