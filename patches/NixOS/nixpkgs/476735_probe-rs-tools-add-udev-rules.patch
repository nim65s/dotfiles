From 6ae9c13dfc51aee20c26e8ecd91fbd5b2630f433 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Sun, 4 Jan 2026 00:11:16 +0100
Subject: [PATCH] probe-rs-tools: add udev rules

Co-authored-by: Alex Martens <7845120+newAM@users.noreply.github.com>
---
 pkgs/by-name/pr/probe-rs-tools/package.nix | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/pkgs/by-name/pr/probe-rs-tools/package.nix b/pkgs/by-name/pr/probe-rs-tools/package.nix
index 5f4f74aabfdeee7e7238a23eb2fcadffb11b7e1c..1f8dd8d91846a795e3d5709da81d059eec59ddb0 100644
--- a/pkgs/by-name/pr/probe-rs-tools/package.nix
+++ b/pkgs/by-name/pr/probe-rs-tools/package.nix
@@ -2,12 +2,20 @@
   lib,
   rustPlatform,
   fetchFromGitHub,
+  fetchurl,
   cmake,
   pkg-config,
   libusb1,
   openssl,
 }:
 
+let
+  # udev rules are in another unversioned repo
+  udevRules = fetchurl {
+    url = "https://raw.githubusercontent.com/probe-rs/webpage/054a0b16831593091a8a5624d0e2305573e860ee/public/files/69-probe-rs.rules";
+    hash = "sha256-yjxld5ebm2jpfyzkw+vngBfHu5Nfh2ioLUKQQDY4KYo=";
+  };
+in
 rustPlatform.buildRustPackage rec {
   pname = "probe-rs-tools";
   version = "0.30.0";
@@ -35,6 +43,10 @@ rustPlatform.buildRustPackage rec {
     openssl
   ];
 
+  postInstall = ''
+    install -D -m 444 ${udevRules} $out/etc/udev/rules.d/69-probe-rs.rules
+  '';
+
   checkFlags = [
     # require a physical probe
     "--skip=cmd::dap_server::server::debugger::test::attach_request"
